<div class="notifications-modal-container">
  <div class="notifications-modal shadow-lg border-0">
    <!-- Header -->
    <div class="notifications-header bg-light border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0 text-dark fw-semibold">
          <i class="bi bi-bell me-2 text-muted"></i>
          Notificaciones
        </h6>
        <div class="d-flex align-items-center gap-2">
          <button
            class="btn btn-sm btn-outline-primary"
            (click)="markAllAsRead()"
            *ngIf="hasUnreadNotifications()"
            title="Marcar todas como leídas"
          >
            <i class="bi bi-check-all me-1"></i>
            Marcar todas
          </button>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading-container text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3 mb-0 text-muted small">Cargando notificaciones...</p>
    </div>

    <!-- Lista de notificaciones -->
    <div class="notifications-list" *ngIf="!loading">
      <div
        *ngFor="
          let notification of notifications;
          trackBy: trackByNotificationId
        "
        class="notification-item-modal border-bottom p-3 position-relative d-flex align-items-start"
        [class.bg-light]="!notification.read"
        [class.border-start]="!notification.read"
        [class.border-primary]="!notification.read"
        [class.border-4]="!notification.read"
        (click)="navigateToTask(notification)"
        [attr.tabindex]="0"
        [attr.aria-label]="'Notificación: ' + notification.message"
        role="button"
        style="cursor: pointer; transition: all 0.2s ease"
      >
        <!-- Indicador de no leída -->
        <div
          class="position-absolute top-0 start-0 mt-3 ms-2"
          *ngIf="!notification.read"
        >
          <span
            class="badge bg-primary rounded-circle p-1"
            style="width: 8px; height: 8px"
          ></span>
        </div>

        <!-- Icono basado en el tipo de notificación -->
        <div
          class="flex-shrink-0 d-flex align-items-center justify-content-center rounded-2 bg-light border me-3"
          style="width: 40px; height: 40px"
        >
          <i
            [class]="
              getNotificationIcon(notification.type) +
              ' ' +
              getNotificationColor(notification.type)
            "
          ></i>
        </div>

        <!-- Contenido principal -->
        <div class="flex-grow-1">
          <div class="fw-semibold text-dark small mb-1">
            {{ getNotificationTitle(notification.type) }}
          </div>

          <div class="text-muted small mb-2" style="line-height: 1.4">
            {{ notification.message }}
          </div>

          <!-- Información de la tarea relacionada -->
          <div
            class="bg-light border rounded p-2 mb-2 small"
            *ngIf="getTaskInfo(notification)"
          >
            <div class="d-flex align-items-center">
              <i class="bi bi-list-task text-muted me-2"></i>
              <strong class="text-dark">{{
                getTaskInfo(notification)?.title
              }}</strong>
              <span
                *ngIf="getTaskInfo(notification)?.dueDate"
                class="text-muted ms-auto"
              >
                <i class="bi bi-calendar3 me-1"></i>
                {{ getTaskInfo(notification)?.dueDate | date : "dd/MM/yyyy" }}
              </span>
            </div>
          </div>

          <!-- Timestamp -->
          <div class="d-flex align-items-center text-muted small">
            <i class="bi bi-clock me-1"></i>
            {{ getTimeAgo(notification.createdAt) }}
          </div>
        </div>

        <!-- Acciones - Solo eliminar -->
        <div class="flex-shrink-0 ms-2">
          <button
            class="btn btn-sm btn-outline-danger border-0"
            (click)="deleteNotification(notification, $event)"
            title="Eliminar notificación"
            [attr.aria-label]="'Eliminar notificación: ' + notification.message"
          >
            <i class="bi bi-trash3"></i>
          </button>
        </div>
      </div>

      <!-- Estado vacío -->
      <div *ngIf="notifications.length === 0" class="text-center py-5 px-4">
        <i class="bi bi-bell-slash display-4 text-muted mb-3"></i>
        <h6 class="text-dark fw-medium mb-2">No tienes notificaciones</h6>
        <p
          class="text-muted small mb-0"
          style="max-width: 280px; margin: 0 auto; line-height: 1.5"
        >
          Te notificaremos cuando tengas nuevas tareas asignadas, cuando alguna
          esté por vencer, o cuando haya actualizaciones importantes.
        </p>
      </div>
    </div>
  </div>
</div>
