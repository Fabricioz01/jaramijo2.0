<div class="notifications-modal-container">
  <div class="notifications-modal">
    <!-- Header -->
    <div class="notifications-header">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
          <i class="bi bi-bell me-2"></i>
          Notificaciones
        </h6>
        <button
          class="btn btn-sm btn-outline-primary"
          (click)="markAllAsRead()"
          *ngIf="hasUnreadNotifications()"
          title="Marcar todas como leídas"
        >
          <i class="bi bi-check-all me-1"></i>
          Marcar todas
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3 mb-0 text-muted">Cargando notificaciones...</p>
    </div>

    <!-- Lista de notificaciones -->
    <div class="notifications-list" *ngIf="!loading">
      <div
        *ngFor="
          let notification of notifications;
          trackBy: trackByNotificationId
        "
        class="notification-item-modal"
        [class.unread]="!notification.read"
        (click)="navigateToTask(notification)"
        [attr.tabindex]="0"
        [attr.aria-label]="'Notificación: ' + notification.message"
        role="button"
      >
        <!-- Indicador de no leída -->
        <div class="unread-indicator-modal" *ngIf="!notification.read"></div>

        <!-- Icono basado en el tipo de notificación -->
        <div
          class="notification-icon-modal"
          [class]="getNotificationColor(notification.type)"
        >
          <i [class]="getNotificationIcon(notification.type)"></i>
        </div>

        <!-- Contenido principal -->
        <div class="notification-body-modal">
          <div class="notification-title-modal">
            {{ getNotificationTitle(notification.type) }}
          </div>

          <div class="notification-message-modal">
            {{ notification.message }}
          </div>

          <!-- Información de la tarea relacionada -->
          <div class="notification-task-modal" *ngIf="notification.task">
            <i class="bi bi-list-task"></i>
            <strong>{{ notification.task.title }}</strong>
            <span *ngIf="notification.task.dueDate" class="text-muted ms-auto">
              <i class="bi bi-calendar3 me-1"></i>
              {{ notification.task.dueDate | date : "dd/MM/yyyy" }}
            </span>
          </div>

          <!-- Timestamp -->
          <div class="notification-time-modal">
            <i class="bi bi-clock"></i>
            {{ getTimeAgo(notification.createdAt) }}
          </div>
        </div>

        <!-- Acciones - Solo eliminar -->
        <div class="notification-actions-modal">
          <button
            class="btn"
            (click)="deleteNotification(notification, $event)"
            title="Eliminar notificación"
            [attr.aria-label]="'Eliminar notificación: ' + notification.message"
          >
            <i class="bi bi-trash3"></i>
          </button>
        </div>
      </div>

      <!-- Estado vacío -->
      <div *ngIf="notifications.length === 0" class="empty-state-modal">
        <i class="bi bi-bell-slash"></i>
        <h6>No tienes notificaciones</h6>
        <p>
          Te notificaremos cuando tengas nuevas tareas asignadas, cuando alguna
          esté por vencer, o cuando haya actualizaciones importantes.
        </p>
      </div>
    </div>
  </div>
</div>
