<div
  class="container-fluid py-4 tarea-detail-container"
  *ngIf="!cargando && tarea"
>
  <div
    class="mb-4 d-flex align-items-center justify-content-between flex-wrap gap-2"
  >
    <button class="btn btn-outline-secondary" (click)="volver()">
      <i class="bi bi-arrow-left me-2"></i>Volver a la lista
    </button>
  </div>
  <div
    class="card shadow-lg w-100 tarea-detail-card border-0 rounded-4 overflow-hidden"
  >
    <div class="card-body p-4">
      <div
        class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4 gap-3"
      >
        <div>
          <h2 class="card-title mb-1 text-primary">{{ tarea.title }}</h2>
          <p class="text-muted mb-0 fs-5">
            {{ tarea.description || "Sin descripci贸n" }}
          </p>
        </div>
        <div class="d-flex flex-wrap gap-2 align-items-center">
          <span
            class="badge fs-6 px-3 py-2 rounded-pill shadow-sm"
            [ngClass]="getStatusColor(tarea.status)"
          >
            <i class="bi bi-flag me-1"></i>{{ getStatusLabel(tarea.status) }}
          </span>
          <span
            class="badge bg-light text-dark border border-primary px-3 py-2 rounded-pill shadow-sm"
          >
            <i class="bi bi-diagram-3 me-1"></i
            >{{ tarea.departamentoId?.name || "-" }}
          </span>
          <span
            class="badge bg-light text-dark border border-secondary px-3 py-2 rounded-pill shadow-sm"
          >
            <i class="bi bi-calendar-event me-1"></i
            >{{ tarea.dueDate | date : "dd/MM/yyyy" }}
          </span>
        </div>
      </div>
      <hr />
      <div class="row gy-4 mb-4">
        <div class="col-md-6 col-lg-4">
          <div class="mb-2 text-muted fw-semibold small">Asignados</div>
          <div
            *ngIf="tarea.assignedToIds?.length; else noAsignados"
            class="d-flex flex-wrap gap-2"
          >
            <span
              *ngFor="let u of tarea.assignedToIds"
              class="badge bg-secondary bg-gradient text-white rounded-pill px-3 py-2 d-flex align-items-center shadow-sm"
            >
              <i class="bi bi-person-circle me-1"></i>{{ u.name }}
            </span>
          </div>
          <ng-template #noAsignados>
            <span class="text-muted">Sin asignar</span>
          </ng-template>
        </div>
        <div class="col-md-6 col-lg-4">
          <div class="mb-2 text-muted fw-semibold small">Creada</div>
          <span
            class="badge bg-light text-dark border border-1 border-success px-3 py-2 rounded-pill shadow-sm"
          >
            <i class="bi bi-clock-history me-1"></i
            >{{ tarea.createdAt | date : "dd/MM/yyyy HH:mm" }}
          </span>
        </div>
        <div class="col-md-6 col-lg-4">
          <div class="mb-2 text-muted fw-semibold small">Actualizada</div>
          <span
            class="badge bg-light text-dark border border-1 border-info px-3 py-2 rounded-pill shadow-sm"
          >
            <i class="bi bi-arrow-repeat me-1"></i
            >{{ tarea.updatedAt | date : "dd/MM/yyyy HH:mm" }}
          </span>
        </div>
      </div>
      <div class="row gy-4 mb-4">
        <div class="col-12 col-lg-8">
          <div class="mb-2 text-muted fw-semibold small">Descripci贸n</div>
          <div
            class="bg-light rounded-3 p-3 shadow-sm"
            style="min-height: 80px"
          >
            <span *ngIf="tarea.description; else sinDesc">{{
              tarea.description
            }}</span>
            <ng-template #sinDesc>
              <span class="text-muted">Sin descripci贸n</span>
            </ng-template>
          </div>
        </div>
        <div class="col-12 col-lg-4">
          <div class="mb-2 text-muted fw-semibold small">Archivos adjuntos</div>
          <div *ngIf="tarea.attachmentIds?.length; else noArchivos">
            <ul class="list-group list-group-flush mt-2">
              <li
                *ngFor="let f of tarea.attachmentIds"
                class="list-group-item d-flex align-items-center justify-content-between gap-2 px-0"
              >
                <div class="d-flex align-items-center gap-2">
                  <i [ngClass]="getFileIcon(f.mimeType)" class="fs-4"></i>
                  <span class="text-break">{{
                    f.originalName || f.filename
                  }}</span>
                </div>
                <button
                  class="btn btn-sm btn-outline-primary"
                  (click)="descargarArchivo(f)"
                >
                  <i class="bi bi-download"></i>
                </button>
              </li>
            </ul>
          </div>
          <ng-template #noArchivos>
            <span class="text-muted">Ninguno</span>
          </ng-template>
        </div>
      </div>
      <div class="row gy-4 mb-4">
        <div class="col-12 col-lg-4">
          <div class="mb-2 text-muted fw-semibold small">
            Archivo de Resoluci贸n
          </div>
          <div *ngIf="tarea.resolutionFileId; else noResolutionFile">
            <div class="d-flex align-items-center gap-2">
              <i
                [ngClass]="getFileIcon(tarea.resolutionFileId.mimeType)"
                class="fs-4"
              ></i>
              <span class="text-break">{{
                tarea.resolutionFileId.originalName
              }}</span>
            </div>
            <button
              class="btn btn-sm btn-outline-primary mt-2"
              (click)="descargarArchivo(tarea.resolutionFileId)"
            >
              <i class="bi bi-download"></i> Descargar
            </button>
          </div>
          <ng-template #noResolutionFile>
            <span class="text-muted">Ninguno</span>
          </ng-template>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-md-4"></div>
      </div>
    </div>
  </div>
  <div *ngIf="cargando" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2 text-muted">Cargando tarea...</p>
  </div>
</div>
